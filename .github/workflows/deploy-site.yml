name: Build and Deploy Site

on:
  push:
    branches: [ main ]  # 代码推送到main分支时触发
  pull_request:
    branches: [ main ]  # PR到main分支时也可触发（用于测试构建）

jobs:
  build-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4  # 拉取代码
      
      # 步骤2：安装 Ruby 构建依赖（用于编译 Ruby gem 原生扩展）
      - name: 安装 Ruby 构建依赖
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential libffi-dev
      
      # 步骤3：清理可能损坏的缓存目录
      - name: 清理缓存目录
        run: rm -rf vendor/bundle
      
      # 步骤4：设置 Ruby 环境并安装依赖
      - name: 设置 Ruby 环境
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.1'  # 根据你的 Gemfile 要求调整版本
          bundler-cache: true  # 自动缓存并安装依赖
      
      # 步骤5：构建 Jekyll 网站
      - name: 构建网站
        run: bundle exec jekyll build
      
      # 步骤6：部署到 GitHub Pages（仅在 main 分支推送时部署）
      - name: 部署到Pages
        if: github.ref == 'refs/heads/main' && github.event_name == 'push'  # 仅在 main 分支推送时部署
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./_site  # Jekyll 默认构建输出目录
          # cname: 你的自定义域名（如果有）


